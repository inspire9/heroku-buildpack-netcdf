#!/usr/bin/env bash

echo $1
echo $2

echo "-----> Installing HDF"
mkdir -p $1/vendor/hdf
cd $1/vendor/hdf
curl "http://pat-public.s3.amazonaws.com/hdf.tgz" -s -o - | tar zxf -

echo "-----> Installing NetCDF"
mkdir -p $1/vendor/netcdf
cd $1/vendor/netcdf
curl "http://pat-public.s3.amazonaws.com/netcdf.tgz" -s -o - | tar zxf -

echo "-----> Updating Environment Variables"
cat <<EOF > $1/export
export CPATH="\$CPATH:/app/vendor/hdf/include:/app/vendor/netcdf/include"
export CPPATH="\$CPPATH:/app/vendor/hdf/include:/app/vendor/netcdf/include"
export LIBRARY_PATH="\$LIBRARY_PATH:/app/vendor/hdf/lib:/app/vendor/netcdf/lib"
EOF

if [ ! -f $1/.bundle/config ]
then
  echo "---" > $1/.bundle/config
fi

echo "BUNDLE_BUILD__RUBY-NETCDF: --with-netcdf-dir=/app/vendor/netcdf" >> $1/.bundle/config

echo 0
